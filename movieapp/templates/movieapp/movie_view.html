{% extends 'movieapp/base3.html' %}
{% load static %}
{% load widget_tweaks %}
{% block title %}{{ movie.name }}{% endblock %}

{% block style %}
<link rel="stylesheet" href="{% static 'movieapp/css/movie_view.css'%}">
{% endblock %}

{% block scripts %}
<script type="text/javascript">
function deleteMovie(){
    if(confirm('This action will delete the movie.')){
            $.ajax({
                url : "{% url 'movie_delete' %}",
                method : 'get',
                data : {'movie_id':"{{ movie.movie_id }}"},
                success: function(retData){
                    if(retData['deleted']==='deleted'){
                        alert('Movie has been deleted ');
                        location = "{% url 'profile' %}";
                    }
                }
            });
    }
    

}
function addToList(){
    $.ajax({
        url : "{%  url 'add-movie-to-list' %}",
        method : 'get',
        data : {'movie_id':"{{ movie.movie_id }}",'list_id':$("#list_id").val()},
        success : function(retData){
            if(retData['status']==='added'){
                alert("Movie added to list");
                reload();
            }
            else{
                alert("Movie already present in list");
            }
        },
    });
}
</script>

{% endblock %}
{% block content%}

<div class="row">
<div class="card p-2">
      <div class="row">
          <div class="col-sm-6 p-1 d-flex" style="height:80%;">
              
              <div class="row" style="width:inherit;">
                <div class="container">
                    <article class="gallery-wrap" style="width:inherit;">
                        <div class="img-big-wrap d-flex justify-content-center pt-2" style="width:inherit;">
                                {% if movie.image %}
                                <img class="img-responsive" src="{{movie.image.url}}" style="max-width:inherit;max-height:inherit;;width:90%;height:auto;">
                                {% else %}
                                    <img src="{% static 'movieapp/images/noimage.png' %}" style="width:100%;height:auto;">
                                {% endif%}
                        </div>

                        
                    </article>
                </div>
                </div>
                <div class="row">
                    <!-- gallery-wrap .end// -->
                    <div class="container text-center mt-3">
                        {% if user_lists %}
                            <p class="h6">Add to list </p>
                            <select id="list_id">
                                {% for list in user_lists %}
                                <option value="{{list.id}}">{{list.name}}</option>
                                {% endfor %}
                            </select>
                            <button class="btn btn-primary p-1" type="button" onclick="addToList()">Add Movie</button>
                        {% endif %}
                    </div>
                </div>
                
            </div>
          <div class="col-sm-6 p-1">

          
          <aside>
              <article class="card-body p-1 m-1">
                  <h2 class="title mb-3">{{ movie.name }}</h2>
  
                 
                  <dl class="param param-feature">
                        <dt>Genre</dt>
                        <dd>{{ movie.genre }}</dd>
                  </dl>
                  <!-- item-property-hor .// -->
                  <dl class="param param-feature">
                      <dt>Release Date</dt>
                      <dd>{{ movie.release_date }}</dd>
                  </dl>
                  


                  <!-- item-property-hor .// -->
                  <dl class="param param-feature">
                      <dt>Description</dt>
                      <dd>{{ movie.description }}</dd>
                  </dl>
                  
                  <!-- item-property-hor .// -->
                    <dl class="param param-feature">
                        <hr>
                        {% if rating_len == 0 %}
                        <p>No ratings yet</p>
                        {% else %}
                        
                        <p>Average rating of <b>{{movie.rating|floatformat:1}}</b> based on {{rating_len}} user{{rating_len|pluralize}}</p>
                        {% if not not_rated and user.is_authenticated %}
                        <small>You have rated this movie</small>
                        {% endif %}
                    </bold>
                        
                        {% endif %}
                     </dl>
                    
                    {% if user.is_authenticated %}
                        {% if not_rated %}
                        
                        <dl class="param param-feature">
                                <dt>Rate this Movie</dt>
                                <dd>
                                    <form id="rate_form" method="post" action="{% url 'rate' movie.movie_id %}">
                                        {% csrf_token %}
                                        <select name='rating' form='rate_form'>
                                            <option value=0>0</option>
                                            <option value=0.5>0.5</option>
                                            <option value=1>1</option>
                                            <option value=1.5>1.5</option>
                                            <option value=2>2</option>
                                            <option value=2.5>2.5</option>
                                            <option value=3>3</option>
                                            <option value=3.5>3.5</option>
                                            <option value=4>4</option>
                                            <option value=4.5>4.5</option>
                                            <option value=5>5</option>
                                        </select>
                                        <input type="submit" value="Rate">
                                    </form>
                                </dd>
                        </dl>
                        
                    {% endif %}    
                    
                    {% else %}
                    
                
                    {% endif %}

                    {% if user.is_superuser or movie.user == user %}
                        <hr>
                        
                        
                        <a class="btn btn-warning p-2" href="{% url 'movie_edit' movie.movie_id %}">Edit Movie<a>
                        <button class="btn btn-danger p-2" onclick="deleteMovie()">Delete Movie</button>
                        
                            <!-- <span>Movie has not been approved</span> -->
                        
                    {% endif %}
                        <span style="visibility:hidden">NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN</span>
                    
              </article>

              
              <!-- card-body.// -->
          </aside>
          <!-- col.// -->
        </div>
      </div>
      <!-- row.// -->
      <div class="row">
          <div class="col">
            <div class="row">
                <p class="h4">Directed by</p><hr>
                {% if director %}
                    <a href="{% url 'artist_view' director.artist_id %}">{{ director.name }}</a>
                {% else %}
                    No data available
                {% endif %}
            </div>
            <div class="row">
                <p class="h4">Cast</p><hr>
                {% if actors %}
                    {% for actor in actors %}
                        {% if forloop.last %}
                            <a href="{% url 'artist_view' actor.artist_id %}">{{actor.name}}</a>
                        {% else %}
                            <a href="{% url 'artist_view' actor.artist_id %}">{{actor.name}}</a>,
                        {% endif %}
                    
                    {% endfor %}
                {% else %}
                    No data available
                {% endif %}

            </div>

          </div>
          
      </div>
      
        
      
  </div>

</div>
  <!-- card.// -->

  <div class="row mr-auto mt-4">
        <p class="h4 font-weight-bold">Reviews({{reviews_len}})</p>
        <br>
        <br>
        <div class="container p-4">
            {% if reviews_len == 0%}
                <p>No reviews for {{ movie.name }}</p>
            {% else %}
                {% for review in reviews %}
                    <div class="row p-3 m-2 border shadow bg-white">
                        <div class="container">

                        
                        <div class="row ">
                            <p class="h5">{{ review.user.username }}</p>
                        </div>
                        <div class="row">
                                <span>{{review.review}}</span>
                        </div>
                        </div>
                    </div>
                    
                {% endfor%}
            {% endif %}
        </div>
        

  </div>
  {% if user.is_authenticated and not current_user_reviewed %}
<div class="row mr-auto my-3">
    <p class="h4 font-weight-bold">Write a review</p>
    <br>
    <br>
    <div class="container">
        <form method='post' action="{% url 'review' movie.movie_id %}">
            <div class="row">
                {% csrf_token %}
                {% render_field review_form.review class+='form-control' %}
            </div>

            <div class="row">
                <input class="btn btn-info float-right" type="submit" value="Submit">
            </div>
            
        </form>

    </div>
</div>  
{% endif %}





{% endblock %}